<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MindMate â€“ AI Therapist</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      padding: 2em;
      max-width: 600px;
      margin: auto;
    }

    h2 {
      color: #007bff;
      text-align: center;
    }

    #chat {
      background: white;
      padding: 1em;
      border-radius: 10px;
      height: 300px;
      overflow-y: auto;
      margin-bottom: 1em;
      border: 1px solid #ccc;
    }

    .user, .ai {
      margin: 0.5em 0;
      padding: 0.5em;
      border-radius: 5px;
    }

    .user {
      background-color: #d0ebff;
    }

    .ai {
      background-color: #fde2e4;
    }

    input[type="text"] {
      width: 70%;
      padding: 10px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 15px;
      font-size: 1em;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 5px;
    }

    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h2>ðŸ§  MindMate â€“ AI Therapist</h2>
  <div id="chat"></div>
  <input type="text" id="userInput" placeholder="How are you feeling?" />
  <button id="sendBtn">Send</button>

  <!-- âœ… Load Sentimood from stable source -->
  <script src="https://cdn.jsdelivr.net/npm/sentimood@1.0.6/lib/sentimood.min.js"></script>

  <!-- âœ… Custom script after library is loaded -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ðŸ›¡ Safety check
      if (typeof Sentimood === 'undefined') {
        alert("Error loading Sentimood library. Please check your internet connection or try again.");
        return;
      }

      const sentiment = new Sentimood();
      const chat = document.getElementById('chat');
      const input = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');

      function addMessage(text, sender) {
        const div = document.createElement('div');
        div.className = sender;
        div.innerHTML = `<strong>${sender === 'user' ? 'You' : 'MindMate'}:</strong> ${text}`;
        chat.appendChild(div);
        chat.scrollTop = chat.scrollHeight;
      }

      function speak(text) {
        const synth = window.speechSynthesis;
        const utter = new SpeechSynthesisUtterance(text);
        synth.speak(utter);
      }

      function respond() {
        const userText = input.value.trim();
        if (!userText) return;

        addMessage(userText, 'user');
        input.value = '';

        const score = sentiment.analyze(userText).score;

        let reply = '';
        if (score < -3) {
          reply = "I'm really sorry you're feeling this way. I'm here for you.";
        } else if (score < 0) {
          reply = "That sounds tough. Want a calming journaling prompt?";
        } else if (score === 0) {
          reply = "Thanks for sharing. Want to reflect on your day?";
        } else if (score < 3) {
          reply = "Nice to hear that. Letâ€™s explore whatâ€™s working well.";
        } else {
          reply = "That's great! Keep holding on to that joy!";
        }

        addMessage(reply, 'ai');
        speak(reply);
      }

      sendBtn.addEventListener('click', respond);
      input.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          respond();
        }
      });
    });
  </script>
</body>
</html>
